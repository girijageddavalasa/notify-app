<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Notify – Audio Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
:root {
  --bg-light: linear-gradient(135deg,#f4f4f4,#e9e9e9);
  --bg-dark:  linear-gradient(135deg,#0f0f0f,#171717);
  --card-light: rgba(255,255,255,.28);
  --card-dark:  rgba(25,25,25,.65);
  --text-dark:#191919;
  --text-light:#fafafa;
  --waveIdle:#7c7c7c;
  --waveActive:#ff3b3b;
  --t:.4s ease;
}
body {
  margin:0; height:100vh;
  display:flex; align-items:center; justify-content:center;
  background:var(--bg-light);
  transition:var(--t);
  font-family:'Poppins',sans-serif; color:var(--text-dark);
}
body.dark { background:var(--bg-dark); color:var(--text-light); }

/* Header + Toggle */
.brand{ position:fixed; top:25px; left:35px; font-weight:700; font-size:1.4rem; }
.toggle-container{ position:fixed; top:25px; right:35px; display:flex; align-items:center; gap:10px; }
.switch{ position:relative; width:56px; height:28px; }
.switch input{ display:none; }
.slider{
  position:absolute; inset:0; background:#ccc; border-radius:30px; transition:.4s;
}
.slider:before{
  content:""; position:absolute; left:3px; bottom:3px;
  width:22px; height:22px; background:white; border-radius:50%; transition:.4s;
}
input:checked + .slider { background:#555; }
input:checked + .slider:before { transform:translateX(28px); }

/* Card */
.card{
  text-align:center; padding:60px 80px;
  border-radius:24px; background:var(--card-light);
  backdrop-filter:blur(18px);
  box-shadow:0 25px 80px rgba(0,0,0,.15);
  transition:var(--t);
}
body.dark .card{ background:var(--card-dark); box-shadow:0 25px 120px rgba(0,0,0,.6); }
h1{ margin-bottom:20px; font-size:2.3rem; }

/* Input */
label{ font-weight:600; display:block; margin-top:10px; }
input[type=number]{
  margin-top:6px; padding:8px 14px; border:none; border-radius:10px;
  background:rgba(255,255,255,.8); text-align:center; width:80px;
}
body.dark input[type=number]{ background:rgba(255,255,255,.1); color:#fff; }

/* Wave + Mic Cluster */
.waveCluster{
  position:relative; width:420px; max-width:90vw;
  height:120px; margin:40px auto 0;
  display:flex; align-items:center; justify-content:center;
}
.waveBars{
  display:flex; align-items:center; justify-content:center;
  gap:6px; perspective:700px;
}
.waveBars span{
  display:block;
  width:6px; height:35px;
  background:var(--waveIdle);
  border-radius:6px;
  animation:equalize 1.8s ease-in-out infinite;
  transform-origin:center bottom;
  box-shadow:0 3px 12px rgba(0,0,0,.25);
}
.waveBars span:nth-child(n){
  animation-delay:calc(var(--i)*0.1s);
}
@keyframes equalize {
  0%,100% { transform:scaleY(0.4); }
  50% { transform:scaleY(1.8); }
}

/* Mic Button */
.micBtn{
  position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
  width:140px; height:140px; border-radius:50%;
  background:radial-gradient(35% 35% at 30% 30%,#2c2c2c 0%,#0f0f0f 65%);
  display:grid; place-items:center;
  cursor:pointer; transition:var(--t);
  box-shadow:
    inset -6px -10px 18px rgba(0,0,0,.65),
    inset 10px 10px 18px rgba(255,255,255,.05),
    0 18px 40px rgba(0,0,0,.35);
}
body.dark .micBtn{
  background:radial-gradient(35% 35% at 30% 30%,#383838,#141414);
}
.micBtn svg{ width:60px; height:60px; transition:.4s; }
.micBtn.active{
  transform:translate(-50%,-55%);
  background:radial-gradient(35% 35% at 30% 30%,#6b0000 0%,#220000 65%);
  box-shadow:
    0 0 25px rgba(255,40,40,.45),
    0 0 55px rgba(255,20,20,.25),
    inset 0 0 25px rgba(255,80,80,.35);
}
.micBtn.active svg{ filter:drop-shadow(0 0 10px rgba(255,58,58,.85)); }

/* Mic Body */
.micBody{ fill:#e8e8e8; }
body.dark .micBody{ fill:#f3f3f3; }
.micBase{ fill:#cfcfcf; }
body.dark .micBase{ fill:#c9c9c9; }
.micBtn.active .micBody, .micBtn.active .micBase{ fill:#ffd6d6; }

/* Active Wave Glow */
.clusterActive .waveBars span{
  background:var(--waveActive);
  box-shadow:0 0 18px rgba(255,40,40,.5);
  animation-duration:.9s;
}

/* Timer + Buttons */
.timer{
  font-weight:700; font-size:1.7rem;
  opacity:0; transform:translateX(-220px);
  transition:all .8s ease; margin-top:30px;
}
.timer.active{
  opacity:1; transform:translateX(0);
  color:#ff4a4a; text-shadow:0 0 8px #ff4a4a;
}
button.viewlog{
  margin-top:20px; padding:10px 26px; border:none;
  border-radius:10px; background:#2b2b2b;
  color:#fff; font-weight:600; cursor:pointer;
  transition:.3s;
}
button.viewlog:hover{ background:#ff3b3b; box-shadow:0 0 15px rgba(255,60,60,.4); }

#progress{ margin-top:25px; font-weight:600; }
</style>
</head>

<body>
<div class="brand">Notify</div>

<div class="toggle-container">
  <span>Light / Dark</span>
  <label class="switch">
    <input type="checkbox" onclick="document.body.classList.toggle('dark')">
    <span class="slider"></span>
  </label>
</div>

<div class="card">
  <h1>Audio Dashboard</h1>

  <label>Duration (seconds):</label>
  <input type="number" id="duration" value="10" min="1" max="600">

  <!-- WAVE + MIC -->
  <div class="waveCluster" id="waveCluster">
    <div class="waveBars" id="bars"></div>

    <div class="micBtn" id="micBtn">
      <svg viewBox="0 0 128 128">
        <rect class="micBody" x="40" y="16" rx="18" ry="18" width="48" height="66"/>
        <rect x="46" y="28" width="36" height="6" rx="3" fill="#9a9a9a"/>
        <rect x="46" y="44" width="36" height="6" rx="3" fill="#9a9a9a"/>
        <rect x="46" y="60" width="36" height="6" rx="3" fill="#9a9a9a"/>
        <rect class="micBase" x="60" y="82" width="8" height="18" rx="4"/>
        <path class="micBase" d="M32,70 a32,32 0 0,0 64,0 l-8,0 a24,24 0 0,1 -48,0 z"/>
        <rect class="micBase" x="40" y="106" width="48" height="8" rx="4"/>
      </svg>
    </div>
  </div>

  <div class="timer" id="timerDisplay">00:00</div>

  <!-- ✅ Fixed View Logs Button -->
  <button class="viewlog" onclick="window.location.href='/logs'">View Logs</button>

  <div id="progress">Status: Idle</div>
</div>

<script>
const barsContainer=document.getElementById('bars');
for(let i=0;i<20;i++){
  const bar=document.createElement('span');
  bar.style.setProperty('--i',i);
  barsContainer.appendChild(bar);
}

let isRecording=false, timeElapsed=0, timerInterval;
const micBtn=document.getElementById('micBtn');
const cluster=document.getElementById('waveCluster');
const timerEl=document.getElementById('timerDisplay');

micBtn.addEventListener('click',()=>handleMic());

function handleMic(){
  if(!isRecording){
    isRecording=true;
    micBtn.classList.add('active');
    cluster.classList.add('clusterActive');
    timerEl.classList.add('active');
    timeElapsed=0;
    startTimer();
    startPipeline();
  }else{
    isRecording=false;
    micBtn.classList.remove('active');
    cluster.classList.remove('clusterActive');
    timerEl.classList.remove('active');
    clearInterval(timerInterval);
    document.getElementById('progress').innerText='Recording stopped.';
  }
}

function startTimer(){
  clearInterval(timerInterval);
  timerInterval=setInterval(()=>{
    timeElapsed++;
    const m=String(Math.floor(timeElapsed/60)).padStart(2,'0');
    const s=String(timeElapsed%60).padStart(2,'0');
    timerEl.textContent=`${m}:${s}`;
  },1000);
}

async function startPipeline(){
  document.getElementById('progress').innerText='Recording in progress...';
  const duration=parseInt(document.getElementById('duration').value);
  const res=await fetch("/api/start-pipeline",{
    method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({duration:duration,target_lang:"es"})
  });
  const data=await res.json();
  if(data.status==="started"){
    document.getElementById('progress').innerText='Pipeline started successfully.';
  }else{
    document.getElementById('progress').innerText='Failed to start pipeline.';
  }
}
</script>
</body>
</html>
